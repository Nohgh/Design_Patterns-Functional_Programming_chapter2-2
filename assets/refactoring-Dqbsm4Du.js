import{r as m,j as e,c as I,R as E}from"./client-DD4c7S6m.js";const P=t=>{const{quantity:s}=t;return t.product.discounts.reduce((n,a)=>s>=a.quantity&&a.rate>n?a.rate:n,0)},F=(t,s)=>{let o=0,n=0;t.forEach(d=>{const{price:r}=d.product,{quantity:c}=d;o+=r*c;const g=P(d);n+=r*c*(1-g)});let a=o-n;return s&&(s.discountType==="amount"?n=Math.max(0,n-s.discountValue):n*=1-s.discountValue/100,a=o-n),{totalBeforeDiscount:Math.round(o),totalAfterDiscount:Math.round(n),totalDiscount:Math.round(a)}},M=(t,s,o)=>t.map(a=>{if(a.product.id===s){const d=a.product.stock,r=Math.max(0,Math.min(o,d));return r>0?{...a,quantity:r}:null}return a}).filter(a=>a!==null),V=t=>t.reduce((s,o)=>Math.max(s,o.rate),0),C=t=>(t*100).toFixed(0),k=(t,s)=>{const o=t.find(n=>n.product.id===s.id);return s.stock-((o==null?void 0:o.quantity)||0)},$=(t,s)=>k(t,s)>0,R=()=>{const[t,s]=m.useState([]),[o,n]=m.useState(null);return{cart:t,selectedCoupon:o,addToCart:l=>{$(t,l)&&s(i=>i.find(u=>u.product.id===l.id)?i.map(u=>u.product.id===l.id?{...u,quantity:Math.min(u.quantity+1,l.stock)}:u):[...i,{product:l,quantity:1}])},removeFromCart:l=>{s(i=>i.filter(p=>p.product.id!==l))},updateQuantity:(l,i)=>{s(p=>M(p,l,i))},applyCoupon:l=>{n(l)},calculateTotal:()=>F(t,o)}},U=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],y={name:"",code:"",discountType:"percentage",discountValue:0},L=t=>{const[s,o]=m.useState(t),[n,a]=m.useState(y),d=g=>{o(l=>[...l,g])},r=()=>{a(y)};return{coupons:s,newCoupon:n,addCoupon:d,setNewCoupon:a,handleAddNewCoupon:()=>{d(n),r()}}},Q=()=>{const[t,s]=m.useState({quantity:0,rate:0});return{newDiscount:t,setNewDiscount:s,handleAddDiscount:({products:n,productId:a,editingProduct:d,updateProduct:r,setEditingProduct:c})=>{const g=n.find(l=>l.id===a);if(g&&d){const l={...g,discounts:[...g.discounts,t]};r(l),c(l),s({quantity:0,rate:0})}}}},B=t=>{const[s,o]=m.useState(t);return{products:s,updateProduct:d=>{o(r=>r.map(c=>c.id===d.id?d:c))},addProduct:d=>{o(r=>[...r,d])}}},S=m.createContext(void 0),O=({children:t,initialProducts:s})=>{const{products:o,updateProduct:n,addProduct:a}=B(s);return e.jsx(S.Provider,{value:{products:o,updateProduct:n,addProduct:a},children:t})},v=()=>{const t=m.useContext(S);if(!t)throw new Error("useProducts는 반드시 ProductProvider 내부에 위치해야합니다.");return t},W=()=>{const{products:t,updateProduct:s}=v(),[o,n]=m.useState(null);return{editingProduct:o,setEditingProduct:n,handleProductNameUpdate:(i,p)=>{if(o&&o.id===i){const u={...o,name:p};n(u)}},handlePriceUpdate:(i,p)=>{if(o&&o.id===i){const u={...o,price:p};n(u)}},handleStockUpdate:(i,p)=>{const u=t.find(j=>j.id===i);if(!u)return;const b={...u,stock:p};s(b),n(b)},handleRemoveDiscount:(i,p)=>{const u=t.find(j=>j.id===i);if(!u)return;const b={...u,discounts:u.discounts.filter((j,x)=>x!==p)};s(b),n(b)},handleEditProduct:i=>{n({...i})},handleEditComplete:()=>{o&&(s(o),n(null))}}},_=()=>{const[t,s]=m.useState(new Set);return{openProductIds:t,toggleProductAccordion:n=>{s(a=>{const d=new Set(a);return d.has(n)?d.delete(n):d.add(n),d})}}},z=()=>{const[t,s]=m.useState(!1);return{isAdmin:t,toggleIsAdmin:()=>{s(!t)}}},A=m.createContext(void 0),G=({children:t})=>{const{cart:s,selectedCoupon:o,addToCart:n,removeFromCart:a,updateQuantity:d,applyCoupon:r,calculateTotal:c}=R();return e.jsx(A.Provider,{value:{cart:s,selectedCoupon:o,addToCart:n,removeFromCart:a,updateQuantity:d,applyCoupon:r,calculateTotal:c},children:t})},w=()=>{const t=m.useContext(A);if(!t)throw new Error("useCartContext는 반드시 CartProvider에 위치하여야 합니다.");return t},D=m.createContext(null),H=({children:t,intialCoupons:s})=>{const{coupons:o,newCoupon:n,addCoupon:a,setNewCoupon:d,handleAddNewCoupon:r}=L(s);return e.jsx(D.Provider,{value:{coupons:o,newCoupon:n,addCoupon:a,setNewCoupon:d,handleAddNewCoupon:r},children:t})},T=()=>{const t=m.useContext(D);if(!t)throw new Error("useCouponContext 반드시 CouponProvider 위치하여야 합니다.");return t},J=({item:t})=>{const{updateQuantity:s,removeFromCart:o}=w(),n=P(t);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,n>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",C(n),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>s(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>s(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>o(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},t.product.id)},K=()=>{const{cart:t}=w();return e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsx(J,{item:s},s.product.id))})},X=({product:t})=>{const{cart:s,addToCart:o}=w(),n=k(s,t);return e.jsx("div",{children:e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${n>0?"text-green-600":"text-red-600"}`,children:["재고: ",n,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",C(V(t.discounts)),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((a,d)=>e.jsxs("li",{children:[a.quantity,"개 이상: ",C(a.rate),"% 할인"]},d))}),e.jsx("button",{onClick:()=>o(t),className:`w-full px-3 py-1 rounded ${n>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:n<=0,children:n>0?"장바구니에 추가":"품절"})]},t.id)})},Y=()=>{const{products:t}=v();return e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsx(X,{product:s},s.id))})},Z=()=>{const{selectedCoupon:t,applyCoupon:s,calculateTotal:o}=w(),{coupons:n}=T(),{totalBeforeDiscount:a,totalAfterDiscount:d,totalDiscount:r}=o();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx(Y,{})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx(K,{}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:c=>s(n[parseInt(c.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),n.map((c,g)=>e.jsxs("option",{value:g,children:[c.name," -"," ",c.discountType==="amount"?`${c.discountValue}원`:`${c.discountValue}%`]},c.code))]}),t&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",t.name,"(",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`," ","할인)"]})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",a.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",r.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",d.toLocaleString(),"원"]})]})]})]})]})]})},ee=()=>{const{openProductIds:t,toggleProductAccordion:s}=_(),{newDiscount:o,setNewDiscount:n,handleAddDiscount:a}=Q(),{products:d,updateProduct:r}=v(),{editingProduct:c,setEditingProduct:g,handleProductNameUpdate:l,handlePriceUpdate:i,handleStockUpdate:p,handleRemoveDiscount:u,handleEditComplete:b,handleEditProduct:j}=W();return e.jsx("div",{className:"space-y-2",children:d.map((x,q)=>e.jsxs("div",{"data-testid":`product-${q+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>s(x.id),className:"w-full text-left font-semibold",children:[x.name," - ",x.price,"원 (재고: ",x.stock,")"]}),t.has(x.id)&&e.jsx("div",{className:"mt-2",children:c&&c.id===x.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:c.name,onChange:h=>l(x.id,h.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:c.price,onChange:h=>i(x.id,parseInt(h.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:c.stock,onChange:h=>p(x.id,parseInt(h.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),c.discounts.map((h,N)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[h.quantity,"개 이상 구매 시"," ",h.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>u(x.id,N),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},N)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:o.quantity,onChange:h=>n({...o,quantity:parseInt(h.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:o.rate*100,onChange:h=>n({...o,rate:parseInt(h.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>a({products:d,productId:x.id,editingProduct:c,updateProduct:r,setEditingProduct:g}),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:b,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[x.discounts.map((h,N)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[h.quantity,"개 이상 구매 시 ",h.rate*100,"% 할인"]})},N)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>j(x),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},x.id))})},te=()=>{const[t,s]=m.useState(!1);return{showNewProductForm:t,setShowNewProductForm:s,handleProductFormToggle:()=>{s(!t)}}},se=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],f={name:"",price:0,stock:0,discounts:[]},ne=()=>{const[t,s]=m.useState(f);return{newProduct:t,setNewProduct:s,handleAddNewProduct:({addProduct:n,setShowNewProductForm:a})=>{const d={...t,id:Date.now().toString()};n(d),s(f),a(!1)}}},oe=()=>{const{showNewProductForm:t,setShowNewProductForm:s,handleProductFormToggle:o}=te(),{newProduct:n,setNewProduct:a,handleAddNewProduct:d}=ne(),{addProduct:r}=v();return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o,className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:t?"취소":"새 상품 추가"}),t&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:n.name,onChange:c=>a({...n,name:c.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:n.price,onChange:c=>a({...n,price:parseInt(c.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:n.stock,onChange:c=>a({...n,stock:parseInt(c.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:()=>d({addProduct:r,setShowNewProductForm:s}),className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})]})},ae=()=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(oe,{}),e.jsx(ee,{})]}),de=()=>{const{coupons:t,newCoupon:s,setNewCoupon:o,handleAddNewCoupon:n}=T();return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:s.name,onChange:a=>o({...s,name:a.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:s.code,onChange:a=>o({...s,code:a.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.discountType,onChange:a=>o({...s,discountType:a.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:s.discountValue,onChange:a=>o({...s,discountValue:parseInt(a.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:()=>n(),className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((a,d)=>e.jsxs("div",{"data-testid":`coupon-${d+1}`,className:"bg-gray-100 p-2 rounded",children:[a.name," (",a.code,"):",a.discountType==="amount"?`${a.discountValue}원`:`${a.discountValue}%`," ","할인"]},d))})]})]})]})},ce=()=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(ae,{}),e.jsx(de,{})]})]}),re=({isAdmin:t,toggleIsAdmin:s})=>e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:s,className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:t?"장바구니 페이지로":"관리자 페이지로"})]})}),le=()=>{const{isAdmin:t,toggleIsAdmin:s}=z();return e.jsx(O,{initialProducts:se,children:e.jsx(H,{intialCoupons:U,children:e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx(re,{isAdmin:t,toggleIsAdmin:s}),e.jsx("main",{className:"container mx-auto mt-6",children:t?e.jsx(ce,{}):e.jsx(G,{children:e.jsx(Z,{})})})]})})})};I.createRoot(document.getElementById("root")).render(e.jsx(E.StrictMode,{children:e.jsx(le,{})}));
